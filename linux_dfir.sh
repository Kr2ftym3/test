#!/bin/bash
#CREATE NECESSARY FOLDERS FOR COLLECTING FILES
mkdir /tmp/collection
chmod 777 /tmp/collection
mkdir /tmp/collection/host_and_os
mkdir /tmp/collection/users_and_groups
mkdir /tmp/collection/logons
mkdir /tmp/collection/environment_and_startup
mkdir /tmp/collection/scheduled_tasks
mkdir /tmp/collection/ssh_configs_and_keys
mkdir /tmp/collection/pam_configuration
mkdir /tmp/collection/network_configuration_and_connections
mkdir /tmp/collection/processes
mkdir /tmp/collection/files_and_directories
mkdir /tmp/collection/installed_software
mkdir /tmp/collection/audit_logs
chmod -R 777 /tmp/collection
#COLLECT INFORMATION ABOUT HOST AND INSTALLED OS
echo "╔══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╗"
echo "║                                                                         ---HOST AND OS---                                                                                    ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         uname                                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
uname
uname &> /tmp/collection/host_and_os/uname.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         hostname                                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
hostname
hostname &> /tmp/collection/host_and_os/hostname.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         os version                                                                                           ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /proc/version
cat /proc/version &> /tmp/collection/host_and_os/cat_proc_version.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         release version                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/*-release
cat /etc/*-release &> /tmp/collection/host_and_os/cat_etc_release.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         fdisk                                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
fdisk -l
fdisk -l > /tmp/collection/host_and_os/fdisk.txt
#COLLECT INFORMATION ABOUT USERS AND GROUPS IN SYSTEM
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---USERS AND GROUPS---                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         whoami                                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
whoami
whoami &> /tmp/collection/users_and_groups/whoami.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         id                                                                                                   ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
id
id &> /tmp/collection/users_and_groups/id.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         groups                                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
grpinfo=`for i in $(cut -d":" -f1 /etc/passwd 2>/dev/null);do id $i;done 2>/dev/null`
echo "$grpinfo"
echo "$grpinfo" &> /tmp/collection/users_and_groups/groups.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         root accounts                                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
roots=`grep -v -E "^#" /etc/passwd 2>/dev/null| awk -F: '$3 == 0 { print $1}' 2>/dev/null`
echo "$roots"
echo "$roots" &> /tmp/collection/users_and_groups/root_accounts.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         sudo permissions                                                                                     ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
sudopermit=`echo '' | sudo -S -l -k 2>/dev/null`
echo "$sudopermit"
echo "$sudopermit" &> /tmp/collection/users_and_groups/sudo_permissions.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         who has been sudo in the past                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
whohasbeensudo=`find /home -name .sudo_as_admin_successful 2>/dev/null`
echo "$whohasbeensudo"
echo "$whohasbeensudo" &> /tmp/collection/users_and_groups/sudo_permissions_in_the_past.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/sudoers                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
sudoers=`grep -v -e '^$' /etc/sudoers 2>/dev/null |grep -v "#" 2>/dev/null`
echo "$sudoers"
echo "$sudoers" &> /tmp/collection/users_and_groups/sudoers.txt
cp -b /etc/sudoers /tmp/collection/users_and_groups
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/sudoers.d/*                                                                                     ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/sudoers.d/*
cat /etc/sudoers.d/* > /tmp/collection/users_and_groups/sudoers.d.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/shadow                                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
shadow=`cut -d: -f1,2,3 /etc/shadow`
echo "$shadow"
cp -b /etc/shadow /tmp/collection/users_and_groups
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/passwd                                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
passwd=`cut -d: -f1,3,5,6 /etc/passwd`
echo "$passwd"
cp -b /etc/passwd /tmp/collection/users_and_groups
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         stored passwords in /etc/passwd                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
stored_passwords=`grep -v '^[^:]*:[x]' /etc/passwd 2>/dev/null`
echo "$stored_passwords"
echo "$stored_passwords" &> /tmp/collection/users_and_groups/stored_passwords.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         bash history for current user                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat ~/.bash_history
cat ~/.bash_history > /tmp/collection/users_and_groups/bash_history_current_user.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         find bash history files for all users                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
bashhistory=`for i in $(getent passwd | cut -d: -f6 ); do grep string ${i}/.bash_history; done`
echo "$bashhistory"
echo "$bashhistory" &> /tmp/collection/users_and_groups/list_of_files_bash_history.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         bash history for all users                                                                           ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
bashhistoryall=`getent passwd | cut -d : -f 6 | sed 's:$:/.bash_history:' | xargs -d '\n' grep -s -H -e "$pattern"`
echo "$bashhistoryall"
echo "$bashhistoryall" &> /tmp/collection/users_and_groups/bash_history_all.txt
#COLLECT INFORMATION ABOUT LOGONS IN SYSTEM
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---LOGONS---                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         who                                                                                                  ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
who
who > /tmp/collection/logons/who.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         last                                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
last -Faixw
last > /tmp/collection/logons/last.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         lastlog                                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
lastlog 2>/dev/null |grep -v "Never" 2>/dev/null
lastlog 2>/dev/null |grep -v "Never" 2>/dev/null > /tmp/collection/logons/lastlog.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         current logons                                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
w
w &> /tmp/collection/logons/current_logons.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         logons (utmp)                                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
utmpdump /var/run/utmp
utmpdump /var/run/utmp > /tmp/collection/logons/utmpdump_var_run_utmp.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         failed logons (btmp)                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
utmpdump /var/log/btmp
utmpdump /var/log/btmp > /tmp/collection/logons/utmpdump_var_log_btmp.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         historical data of utmp (wtmp)                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
utmpdump /var/log/wtmp
utmpdump /var/log/wtmp > /tmp/collection/logons/utmpdump_var_log_wtmp.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /var/log/auth.log                                                                                    ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
auth=`cat /var/log/auth.log* 2>/dev/null |grep -v "pam_unix\|gnome-keyring-daemon\|dbus-daemon\|gdm-password\|pkexec\|polkitd\|systemd-logind" 2>/dev/null`
echo "$auth"
cp -b /var/log/auth.log* /tmp/collection/logons
cat /var/log/auth.log* 2>/dev/null |grep -v "pam_unix\|gnome-keyring-daemon\|dbus-daemon\|gdm-password\|pkexec\|polkitd\|systemd-logind" 2>/dev/null > /tmp/collection/logons/cat_
#COLLECT INFORMATION ABOUT ENVIRONMENT PARAMETERS AND STARTUP PROGRAMS / SCRIPTS
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---ENVIRONMENT AND STARTUP---                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         environments                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
envinfo=`env 2>/dev/null | grep -v 'LS_COLORS' 2>/dev/null`
echo $envinfo
echo $envinfo &> /tmp/collection/environment_and_startup/environment.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         path                                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
pathinfo=`echo $PATH 2>/dev/null`
echo $pathinfo
echo $pathinfo &> /tmp/collection/environment_and_startup/pathinfo.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         shells                                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
shellinfo=`cat /etc/shells 2>/dev/null`
echo $shellinfo
echo $shellinfo &> /tmp/collection/environment_and_startup/shellinfo.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/profile                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/profile
cat /etc/profile > /tmp/collection/environment_and_startup/cat_etc_profile.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/profile.d/                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/profile.d/*
cat /etc/profile.d/* > /tmp/collection/environment_and_startup/cat_etc_profile.d.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/bash.bashrc                                                                                     ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/bash.bashrc
cat /etc/bash.bashrc > /tmp/collection/environment_and_startup/cat_bash.bashrc.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ~/.bash_profile                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat ~/.bash_profile
cat ~/.bash_profile > /tmp/collection/environment_and_startup/cat_.bash_profile.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ~/.bashrc                                                                                            ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat ~/.bashrc
cat ~/.bashrc > /tmp/collection/environment_and_startup/cat_.bashrc.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         autoruns                                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /etc/*.d
ls -la /etc/*.d > /tmp/collection/environment_information/ls_etc_d.txt
#COLLECT INFORMATION ABOUT SCHEDULED TASKS
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---SCHEDULED TASKS---                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         crontab                                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
crontab -l
crontab -l > /tmp/collection/scheduled_tasks/crontab.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         crontab for all users                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
getent passwd | awk -F: '{ print $1 }' | sudo xargs -n1 crontab -l -u 
getent passwd | awk -F: '{ print $1 }' | sudo xargs -n1 crontab -l -u &> /tmp/collection/scheduled_tasks/crontab_for_all_users.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/cron.*                                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /etc/cron.*
ls -la /etc/cron.* > /tmp/collection/scheduled_tasks/ls_etc_cron.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/cron.*/*                                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/cron.*/*
cat /etc/cron.*/* > /tmp/collection/scheduled_tasks/cat_etc_cron.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/crontab                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/crontab
cat /etc/crontab > /tmp/collection/scheduled_tasks/cat_crontab.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /var/spool/cron/*                                                                                    ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /var/spool/cron/*
cat /var/spool/cron/* > /tmp/collection/scheduled_tasks/cat_var_spool_cron.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /usr/lib/cron/                                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /usr/lib/cron/
cat /usr/lib/cron/ > /tmp/collection/scheduled_tasks/cat_usr_lib_cron.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /usr/lib/cron/tabs                                                                                   ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /usr/lib/cron/tabs
cat /usr/lib/cron/tabs > /tmp/collection/scheduled_tasks/cat_usr_lib_cron_tabs.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/anacrontab                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat cat /etc/anacrontab
cat cat /etc/anacrontab > /tmp/collection/scheduled_tasks/cat_etc_anacrontab.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/anacron                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /var/spool/anacron
ls -la /var/spool/anacron > /tmp/collection/scheduled_tasks/ls_var_spool_anacron.txt
#COLLECT INFORMATION ABOUT SSH CONFIGURATION AND STORED AUTHORIZED KEYS
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---SSH CONFIGURATION AND KEYS---                                                                     ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/ssh/sshd_config                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/ssh/sshd_config
cat /etc/ssh/sshd_config > /tmp/collection/ssh_configs_and_keys/cat_etc_ssh_sshd_config.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ssh permit root login                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
sshrootlogin=`grep "PermitRootLogin " /etc/ssh/sshd_config 2>/dev/null | grep -v "#" | awk '{print  $2}'`
echo $sshrootlogin
echo $sshrootlogin &> /tmp/collection/ssh_configs_and_keys/permit_root_login.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         list of ssh configs and keys                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
sshfiles=`find / \( -name "id_dsa*" -o -name "id_rsa*" -o -name "known_hosts" -o -name "authorized_hosts" -o -name "authorized_keys" \) -exec ls -la {} 2>/dev/null \;`
echo $sshfiles
echo $sshfiles &> /tmp/collection/ssh_configs_and_keys/list_ssh_configs_keys.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /home/*/.ssh/*                                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /home/*/.ssh/*
ls -la /home/*/.ssh/* > /tmp/collection/ssh_configs_and_keys/ls_home_ssh.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /home/*/.ssh/id_rsa.pub                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /home/*/.ssh/id_rsa.pub
cat /home/*/.ssh/id_rsa.pub > /tmp/collection/ssh_configs_and_keys/cat_home_ssh_id_rsa.pub.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /home/*/.ssh/authorized_keys                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /home/*/.ssh/authorized_keys
cat /home/*/.ssh/authorized_keys > /tmp/collection/ssh_configs_and_keys/cat_home_ssh_authorized_keys.txt
#COLLECT INFORMATION ABOUT PAM CONFIGURATION
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---PAM CONFIGURATION---                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/pam.conf                                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/pam.conf
cat /etc/pam.conf &> /tmp/collection/pam_information/cat_etc_pam.conf.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/pam.d/sudo                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/pam.d/sudo
cat /etc/pam.d/sudo &> /tmp/collection/pam_information/cat_etc_pam.d_sudo.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/pam.d/                                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /etc/pam.d/
ls -la /etc/pam.d/ &> /tmp/collection/pam_information/ls_etc_pam.d.txt
#COLLECT INFORMATION ABOUT NETWORK CONFIGURATION AND NETWORK CONNECTIONS
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---NETWORK CONFIGURATION AND CONNECTIONS                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ifconfig                                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ifconfig -a
ifconfig -a > /tmp/collection/network_configuration_and_connections/ifconfig.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         iptables                                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
iptables -L
iptables -L > /tmp/collection/network_configuration_and_connections/iptables.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/iptables                                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /etc/iptables
ls -la /etc/iptables &> /tmp/collection/network_configuration_and_connections/ls_iptables.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /etc/iptables/*.v4   etc/iptables/*.v6                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cat /etc/iptables/*.v4
cat /etc/iptables/*.v4 &> /tmp/collection/network_configuration_and_connections/cat_iptables_v4.txt
cat /etc/iptables/*.v6
cat /etc/iptables/*.v6 &> /tmp/collection/network_configuration_and_connections/cat_iptables_v6.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         dns resolve                                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
nsinfo=`grep "nameserver" /etc/resolv.conf 2>/dev/null`
echo $nsinfo
echo $nsinfo &> /tmp/collection/network_configuration_and_connections/dns.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         dns settings                                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
nsinfosysd=`systemd-resolve --status 2>/dev/null`
echo $nsinfosysd
echo $nsinfosysd &> /tmp/collection/network_configuration_and_connections/dns_settings.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         arp                                                                                                  ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
arp -a
arp -a &> /tmp/collection/network_configuration_and_connections/arp.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         route                                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
route
route &> /tmp/collection/network_configuration_and_connections/route.txt
echo "║                                                                         netstat                                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
netstat -lnptux
netstat -lnptux > /tmp/collection/network_configuration_and_connections/netstat.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         sockets                                                                                              ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ss -atu
ss -atu > /tmp/collection/network_configuration_and_connections/ss.txt
#COLLECT INFORMATION ABOUT STARTED PROCESSES AND THEIR FILES
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---PROCESSES--                                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ps                                                                                                   ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ps -auxwf
ps -auxwf > /tmp/collection/processes/ps.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         process working directories                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -alr /proc/*/cwd
ls -alr /proc/*/cwd > /tmp/collection/processes/process_working_directories.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         deleted but running binaries                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -alr /proc/*/exe 2> /dev/null |  grep deleted
ls -alr /proc/*/exe 2> /dev/null |  grep deleted &> /tmp/collection/processes/deleted_but_running_binaries.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         lsof                                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
lsof
lsof &> /tmp/collection/processes/lsof.txt
#COLLECT INFORMATION ABOUT DIFFERENT INTERESTING FILES AND DIRECTORIES
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---FILES AND DIRECTORIES---                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         modified files                                                                                       ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
#modified_files=`find / -mtime -1` # измененные файлы за последний день
modified_files=`find /etc /tmp /home /var/tmp -type f -printf '%TY-%Tm-%Td %TT %p\n' | sort -r | grep 2021-12-01` # измененные файлы в указанных каталогах за определенную дату
echo "$modified_files"
echo "$modified_files" &> /tmp/collection/files_and_directories/modified_files.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         hidden files and directories                                                                         ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find / -type d -name ".*"
find / -type d -name ".*" &> /tmp/collection/files_and_directories/hidden_files_and_directories.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         list files in /tmp                                                                                   ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find /tmp
find /tmp &> /tmp/collection/files_and_directories/tree_tmp_directory.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         files and directories with no user/group name                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find / \( -nouser -o -nogroup \) -exec ls -lg  {} \;
find / \( -nouser -o -nogroup \) -exec ls -lg  {} \; &> /tmp/collection/files_and_directories/files_and_directories_with_no_group_user_name.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         kernel modules and extensions                                                                        ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /lib/modules/*/kernel/*
ls -la /lib/modules/*/kernel/* > /tmp/collection/files_and_directories/ls_lib_molules_kernel.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         modified files last N days                                                                           ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find / –xdev -mtime 1
find / –xdev -mtime 1 &> /tmp/collection/files_and_directories/last_modified_files.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         accessed files last N days                                                                           ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find / –xdev -atime 1
find / –xdev -atime 1 &> /tmp/collection/files_and_directories/last_accessed_files.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         change owner for files last N days                                                                   ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
find / –xdev -ctime 1
find / –xdev -ctime 1 &> /tmp/collection/files_and_directories/last_change_owner_or_attrib_files.txt
#COLLECT INFORMATION ABOUT INSTALLED SOFTWARE, SUCH AS DATABASES, WEB SERVERS AND CONTAINERS
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---INSTALLED SOFTWARE---                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /usr/bin/                                                                                            ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /usr/bin/
ls -la /usr/bin/ > /tmp/collection/installed_software/ls_usr_bin.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         /usr/local/bin/                                                                                      ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -la /usr/local/bin/
ls -la /usr/local/bin/ > /tmp/collection/installed_software/ls_usr_local_bin.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         mysql                                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
mysql --version
mysql --version &> /tmp/collection/installed_software/mysql_version.txt
cat ~/.mysql_history
cat ~/.mysql_history &> /tmp/collection/installed_software/mysql_history_files.txt
ls -la /var/log/mysql
cp -b /var/log/mysql/* /tmp/collection/installed_software/mysql/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         postgres                                                                                             ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
psql -V
psql -V &> /tmp/collection/installed_software/postgres_version.txt
cat ~/.psql_history
cat ~/.psql_history &> /tmp/collection/installed_software/postgres_history_files.txt
ls -la /var/log/postgresql
cp -b /var/log/postgresql/* /tmp/collection/installed_software/postgres/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         apache                                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
apache2 -v
apache2 -v &> /tmp/collection/installed_software/apache_version.txt
ls -la /var/log/httpd
cp -b /var/log/httpd/* /tmp/collection/installed_software/apache/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         nginx                                                                                                ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
nginx -v
nginx -v &> /tmp/collection/installed_software/nginx_version.txt
ls -la /var/log/nginx
cp -b /var/log/nginx/* /tmp/collection/installed_software/nginx/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         java and apache tomcat                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
java -cp lib/catalina.jar org.apache.catalina.util.ServerInfo
java -cp lib/catalina.jar org.apache.catalina.util.ServerInfo &> /tmp/collection/installed_software/java_tomcat_version.txt
ls -la /var/log/tomcat*
cp -b /var/log/tomcat*/* /tmp/collection/installed_software/apache_tomcat/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         git                                                                                                  ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
git --version
git --version &> /tmp/collection/installed_software/git_version.txt
ls -la /var/log/gitlab/nginx
cp -b /var/log/gitlab/nginx/* /tmp/collection/installed_software/git/nginx/
ls -la /var/log/gitlab/gitlab-workhorse
cp -b /var/log/gitlab/gitlab-workhorse/* /tmp/collection/installed_software/git/gitlab-workhorse/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         docker                                                                                               ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
docker --version
docker --version &> /tmp/collection/installed_software/docker_version.txt
docker_history=`for i in $(sudo docker image ls -q | cut -d" " -f 1);do sudo docker history $i;done`
echo "$docker_history"
echo "$docker_history" &> /tmp/collection/installed_software/docker_image_history.txt
#COLLECT NECESSARY INFORMATION FROM /VAR/LOG/
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         ---AUDIT LOGS---                                                                                     ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         list log files in /var/log/                                                                          ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
ls -al /var/log/*
ls -al /var/log/* > /tmp/collection/audit_logs/ls_var_log.txt
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
echo "║                                                                         copy /var/log/syslog                                                                                 ║"
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
cp -b /var/log/syslog* /tmp/collection/audit_logs
echo "╠══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╣"
#CREATE ARCHIVE WITH COLLECTED FILES
tar -cvf /tmp/collection.tar /tmp/collection
chmod 777 /tmp/collection.tar
echo "╚══════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════╝"
